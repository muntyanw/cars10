<?php
namespace App\Components\Parser;

use Goutte\Client;
/**
 * Description of CustomClient
 *
 * @author alexp
 */
class CustomClient extends Client {

    private $proxies = null;
    private $currentProxy = null;
    private $currentProxyArrayIndex = null;
    

    public function __construct($server = [],$history = null,$cookieJar = null) {
        $this->setProxies();
        $this->setProxyIndexPair();
        
        $server['proxy'] = $this->currentProxy;
        parent::__construct($server,$history,$cookieJar);
        
    }

    private  function knuthShuffle(&$arr) {
        for ($i = count($arr) - 1; $i > 0; $i--) {
            $rnd = mt_rand(0, $i);
            list($arr[$i], $arr[$rnd]) = array($arr[$rnd], $arr[$i]);
        }
    }

    private function setProxies(){
        
        $this->proxies = $this->getArrayOfProxies();
    }
    
    public function getProxyIndexPair(){
        return [$this->currentProxy, $this->currentProxyArrayIndex];
    }
    

    public function setProxyIndexPair(){
        
        $oldIndex = $this->currentProxyArrayIndex;
        $oldValue = $this->currentProxy;
        
        if($oldIndex){
            unset($this->proxies[$oldIndex]);    
        }
        
        $this->knuthShuffle($this->proxies);
        
       $this->currentProxyArrayIndex = array_rand($this->proxies);
       $this->currentProxy = $this->proxies[$this->currentProxyArrayIndex];
       
       $this->proxies[$oldIndex] = $oldValue;
        
    }

    private function getArrayOfProxies() {
        return unserialize('a:256:{i:0;s:18:"5.161.100.145:1080";i:1;s:20:"184.178.172.28:15294";i:2;s:20:"192.111.137.37:18762";i:3;s:17:"98.162.25.16:4145";i:4;s:18:"98.162.25.29:31679";i:5;s:17:"98.162.96.52:4145";i:6;s:17:"72.195.34.41:4145";i:7;s:17:"72.195.34.58:4145";i:8;s:19:"72.206.181.123:4145";i:9;s:19:"72.221.232.155:4145";i:10;s:20:"72.221.196.157:35904";i:11;s:18:"98.162.96.53:10663";i:12;s:18:"67.201.33.10:25283";i:13;s:17:"98.162.25.4:31654";i:14;s:19:"72.210.221.197:4145";i:15;s:18:"174.64.199.79:4145";i:16;s:15:"172.64.68.47:80";i:17;s:15:"172.67.70.82:80";i:18;s:17:"141.193.213.69:80";i:19;s:16:"172.67.192.28:80";i:20;s:17:"103.21.244.186:80";i:21;s:16:"172.67.181.74:80";i:22;s:16:"172.67.181.36:80";i:23;s:17:"103.21.244.176:80";i:24;s:16:"172.64.171.72:80";i:25;s:15:"172.67.181.2:80";i:26;s:16:"103.21.244.25:80";i:27;s:15:"172.64.142.2:80";i:28;s:17:"103.21.244.145:80";i:29;s:17:"103.21.244.164:80";i:30;s:16:"172.67.181.49:80";i:31;s:17:"103.21.244.225:80";i:32;s:20:"50.207.130.238:54321";i:33;s:18:"24.249.199.12:4145";i:34;s:19:"35.222.120.139:8000";i:35;s:20:"184.178.172.18:15280";i:36;s:18:"98.188.47.150:4145";i:37;s:19:"174.75.211.222:4145";i:38;s:19:"70.166.167.55:57745";i:39;s:20:"184.181.217.213:4145";i:40;s:17:"172.67.181.160:80";i:41;s:17:"172.67.181.118:80";i:42;s:17:"172.64.201.125:80";i:43;s:16:"172.64.142.76:80";i:44;s:16:"172.67.176.11:80";i:45;s:16:"172.67.180.10:80";i:46;s:14:"172.67.44.9:80";i:47;s:16:"172.67.192.10:80";i:48;s:17:"172.67.191.239:80";i:49;s:16:"172.64.149.94:80";i:50;s:15:"172.64.152.2:80";i:51;s:16:"172.64.207.96:80";i:52;s:17:"172.64.151.202:80";i:53;s:16:"103.21.244.81:80";i:54;s:16:"162.247.241.1:80";i:55;s:16:"103.21.244.37:80";i:56;s:15:"172.67.180.3:80";i:57;s:17:"172.67.191.245:80";i:58;s:16:"162.247.241.4:80";i:59;s:17:"103.21.244.100:80";i:60;s:16:"103.21.244.99:80";i:61;s:15:"172.67.70.14:80";i:62;s:15:"172.67.70.10:80";i:63;s:17:"172.67.181.163:80";i:64;s:17:"141.193.213.90:80";i:65;s:15:"172.64.95.28:80";i:66;s:17:"103.21.244.197:80";i:67;s:18:"141.193.213.228:80";i:68;s:18:"208.113.134.223:80";i:69;s:17:"172.67.212.157:80";i:70;s:15:"172.64.203.2:80";i:71;s:16:"172.67.79.154:80";i:72;s:17:"172.67.206.105:80";i:73;s:16:"172.67.181.16:80";i:74;s:17:"172.67.181.108:80";i:75;s:16:"172.67.181.97:80";i:76;s:16:"172.67.181.62:80";i:77;s:16:"172.67.181.76:80";i:78;s:17:"172.67.181.140:80";i:79;s:16:"172.67.181.72:80";i:80;s:15:"172.67.192.1:80";i:81;s:17:"172.67.191.223:80";i:82;s:17:"172.67.191.227:80";i:83;s:17:"103.21.244.191:80";i:84;s:17:"103.21.244.198:80";i:85;s:17:"172.67.202.242:80";i:86;s:17:"172.67.181.130:80";i:87;s:17:"172.67.181.150:80";i:88;s:15:"172.67.70.88:80";i:89;s:16:"172.67.16.210:80";i:90;s:16:"172.67.110.87:80";i:91;s:15:"172.67.12.34:80";i:92;s:16:"172.64.145.92:80";i:93;s:17:"172.64.152.180:80";i:94;s:14:"172.67.75.5:80";i:95;s:15:"172.64.133.2:80";i:96;s:16:"172.67.110.33:80";i:97;s:17:"103.21.244.220:80";i:98;s:16:"172.64.142.68:80";i:99;s:16:"172.67.181.15:80";i:100;s:17:"172.67.181.109:80";i:101;s:18:"141.193.213.181:80";i:102;s:16:"172.67.75.177:80";i:103;s:16:"172.67.83.151:80";i:104;s:15:"172.64.141.2:80";i:105;s:17:"103.21.244.143:80";i:106;s:16:"103.21.244.88:80";i:107;s:16:"172.64.148.75:80";i:108;s:17:"172.67.177.253:80";i:109;s:16:"172.67.42.113:80";i:110;s:15:"172.66.40.89:80";i:111;s:15:"172.64.95.40:80";i:112;s:16:"172.64.136.64:80";i:113;s:17:"103.21.244.101:80";i:114;s:17:"103.21.244.195:80";i:115;s:17:"172.64.159.199:80";i:116;s:17:"172.64.193.212:80";i:117;s:17:"172.67.181.123:80";i:118;s:15:"103.21.244.5:80";i:119;s:16:"172.67.180.14:80";i:120;s:17:"172.67.171.237:80";i:121;s:15:"172.67.70.89:80";i:122;s:16:"172.67.75.174:80";i:123;s:18:"141.193.213.176:80";i:124;s:16:"172.64.68.249:80";i:125;s:17:"141.193.213.26:80";i:126;s:15:"172.64.145.2:80";i:127;s:15:"172.67.14.54:80";i:128;s:16:"103.21.244.34:80";i:129;s:17:"172.64.136.149:80";i:130;s:17:"172.67.181.117:80";i:131;s:16:"172.67.75.168:80";i:132;s:16:"172.67.43.119:80";i:133;s:15:"172.64.202.2:80";i:134;s:17:"172.67.182.147:80";i:135;s:17:"172.64.170.227:80";i:136;s:14:"172.67.82.8:80";i:137;s:17:"141.193.213.45:80";i:138;s:16:"172.64.155.36:80";i:139;s:17:"172.67.181.242:80";i:140;s:16:"172.67.191.44:80";i:141;s:17:"141.193.213.99:80";i:142;s:17:"141.193.213.76:80";i:143;s:15:"172.64.154.2:80";i:144;s:16:"172.67.70.210:80";i:145;s:16:"172.64.133.99:80";i:146;s:17:"172.64.150.229:80";i:147;s:16:"172.67.167.46:80";i:148;s:15:"172.67.188.7:80";i:149;s:17:"172.67.126.178:80";i:150;s:14:"172.67.3.89:80";i:151;s:18:"141.193.213.221:80";i:152;s:18:"141.193.213.123:80";i:153;s:18:"141.193.213.217:80";i:154;s:17:"172.67.213.162:80";i:155;s:17:"103.21.244.113:80";i:156;s:17:"103.21.244.166:80";i:157;s:16:"103.21.244.45:80";i:158;s:16:"172.65.253.78:80";i:159;s:16:"172.67.181.40:80";i:160;s:15:"172.67.181.7:80";i:161;s:15:"103.21.244.2:80";i:162;s:14:"172.67.8.19:80";i:163;s:17:"172.67.181.248:80";i:164;s:16:"172.67.75.188:80";i:165;s:16:"172.67.190.45:80";i:166;s:15:"172.64.144.2:80";i:167;s:17:"103.21.244.129:80";i:168;s:16:"172.64.101.67:80";i:169;s:15:"172.64.156.2:80";i:170;s:16:"172.67.192.25:80";i:171;s:17:"172.67.182.128:80";i:172;s:16:"172.64.141.12:80";i:173;s:16:"172.67.33.192:80";i:174;s:16:"172.67.180.44:80";i:175;s:17:"172.67.176.105:80";i:176;s:16:"172.67.75.187:80";i:177;s:17:"141.193.213.14:80";i:178;s:15:"172.64.157.2:80";i:179;s:15:"172.64.146.2:80";i:180;s:17:"103.21.244.254:80";i:181;s:17:"103.21.244.124:80";i:182;s:16:"103.21.244.66:80";i:183;s:15:"172.67.97.27:80";i:184;s:18:"141.193.213.131:80";i:185;s:16:"172.67.75.169:80";i:186;s:15:"172.67.85.32:80";i:187;s:17:"172.67.181.171:80";i:188;s:16:"172.67.181.25:80";i:189;s:16:"172.67.70.224:80";i:190;s:15:"172.67.3.129:80";i:191;s:16:"172.64.104.38:80";i:192;s:17:"172.67.191.232:80";i:193;s:16:"172.67.55.226:80";i:194;s:15:"172.64.69.41:80";i:195;s:16:"172.67.71.104:80";i:196;s:18:"65.169.38.73:26592";i:197;s:18:"66.29.154.103:1080";i:198;s:16:"172.67.181.10:80";i:199;s:16:"172.67.182.35:80";i:200;s:16:"172.67.182.63:80";i:201;s:17:"172.67.255.220:80";i:202;s:16:"172.67.75.153:80";i:203;s:16:"172.67.43.110:80";i:204;s:17:"172.64.110.180:80";i:205;s:17:"172.64.140.232:80";i:206;s:17:"172.64.136.199:80";i:207;s:17:"141.193.213.84:80";i:208;s:17:"103.21.244.126:80";i:209;s:17:"103.21.244.181:80";i:210;s:17:"103.21.244.183:80";i:211;s:16:"103.21.244.69:80";i:212;s:15:"172.67.94.15:80";i:213;s:16:"172.67.74.107:80";i:214;s:15:"172.67.180.4:80";i:215;s:16:"172.67.192.13:80";i:216;s:15:"172.67.55.30:80";i:217;s:17:"103.21.244.106:80";i:218;s:16:"172.67.70.128:80";i:219;s:15:"172.67.70.29:80";i:220;s:17:"172.67.171.236:80";i:221;s:17:"172.67.172.154:80";i:222;s:16:"172.64.80.165:80";i:223;s:18:"141.193.213.158:80";i:224;s:15:"172.67.6.231:80";i:225;s:17:"172.67.146.112:80";i:226;s:16:"172.67.70.162:80";i:227;s:16:"172.67.30.175:80";i:228;s:15:"172.67.211.9:80";i:229;s:17:"172.67.181.113:80";i:230;s:16:"172.67.190.88:80";i:231;s:15:"172.67.3.141:80";i:232;s:16:"172.67.180.11:80";i:233;s:17:"172.67.213.134:80";i:234;s:17:"172.67.218.192:80";i:235;s:15:"172.67.43.93:80";i:236;s:17:"172.67.185.185:80";i:237;s:17:"172.67.191.224:80";i:238;s:17:"172.64.146.137:80";i:239;s:17:"172.67.117.194:80";i:240;s:16:"172.67.181.87:80";i:241;s:17:"172.67.167.157:80";i:242;s:18:"141.193.213.236:80";i:243;s:16:"172.67.75.193:80";i:244;s:17:"141.193.213.73:80";i:245;s:17:"172.64.128.159:80";i:246;s:17:"103.21.244.135:80";i:247;s:16:"172.67.182.83:80";i:248;s:17:"172.67.191.253:80";i:249;s:17:"172.64.156.213:80";i:250;s:16:"172.67.225.30:80";i:251;s:16:"172.64.206.54:80";i:252;s:17:"172.64.150.225:80";i:253;s:16:"172.67.180.19:80";i:254;s:16:"172.67.167.63:80";i:255;s:17:"172.67.191.254:80";}');
    }

}
